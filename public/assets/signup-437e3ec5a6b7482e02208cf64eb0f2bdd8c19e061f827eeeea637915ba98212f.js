$(function(){function e(){var e=/^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;return 0!=$("#login_user_id").val().length&&e.test($("#login_user_id").val())?($("#login_user_id").removeClass("warn"),$("#login_user_id").siblings(".warning").removeClass("active"),!0):($("#login_user_id").addClass("warn"),$("#login_user_id").siblings(".warning").addClass("active"),!1)}function n(){return $("#password").val().length>0&&$("#password").val()==$("#password_confirm").val()?($("#password").removeClass("warn"),$("#password_confirm").removeClass("warn"),$("#password_confirm").siblings(".warning").removeClass("active"),!0):($("#password").addClass("warn"),$("#password_confirm").addClass("warn"),$("#password_confirm").siblings(".warning").addClass("active"),!1)}function s(){return $("#name").val().length>0?($("#name").removeClass("warn"),$("#name").siblings(".warning").removeClass("active"),!0):($("#name").addClass("warn"),$("#name").siblings(".warning").addClass("active"),!1)}function a(){var e=/^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i;return 0!=$("#email").val().length&&e.test($("#email").val())?($("#email").removeClass("warn"),$("#email").siblings(".warning").removeClass("active"),!0):($("#email").addClass("warn"),$("#email").siblings(".warning").addClass("active"),!1)}$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}}),$(document).ready(function(){if(MiilkAuth.signupInfo(),null!=MiilkAuth.socialInfo){let e,n,s,a;s=JSON.stringify(MiilkAuth.socialToken),"kakao"===MiilkAuth.loginProvider?(e=MiilkAuth.socialInfo.properties.nickname,n=MiilkAuth.socialInfo.kakao_account.email,a=MiilkAuth.socialInfo.id):"naver"!==MiilkAuth.loginProvider&&"google"!==MiilkAuth.loginProvider||(e=MiilkAuth.socialInfo.name,n=MiilkAuth.socialInfo.email,a=MiilkAuth.socialInfo.id),$("#name").val(e),$("#email").val(n),$("#social_token").val(s),$("#login_user_id").val(a),$("#login_provider").val(MiilkAuth.loginProvider)}}),$(".terms-container .terms").click(function(){const e=$(this).children(".box");$(e).hasClass("active")?$(e).removeClass("active"):$(e).addClass("active")}),$("#confirmBtn").click(function(e){if(e.preventDefault(),1==$("#login_user_id").attr("verified"))return;const n=$("#confirm_code").val();if(0==n.length)return $("#confirm_code").addClass("warn"),$("#confirmResult").addClass("warn"),$("#confirmResult").text("\uc778\uc99d\ubc88\ud638\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."),!1;const s={target:$("#login_user_id").val(),code:n};$.ajax({url:"/users/verify",type:"POST",dataType:"json",data:s,success:function(){$("#confirmResult").removeClass("warn"),$("#confirmResult").text("\uc778\uc99d\ubc88\ud638\uc774 \uc644\ub8cc\ub418\uc5b4\uc2b5\ub2c8\ub2e4."),$("#login_user_id").removeClass("warn"),$("#confirm_code").removeClass("warn"),$("#confirmBtn").addClass("verified"),$("#login_user_id").attr("verified",!0),$("#login_user_id").attr("readonly","readonly")},error:function(){$("#confirm_code").addClass("warn"),$("#confirmResult").addClass("warn"),$("#confirmResult").text("\uc778\uc99d\ubc88\ud638\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.")}})}),$("#resendRequestBtn").click(function(n){n.preventDefault();const s=$("#login_user_id").val();if(!e())return $("#login_user_id").focus(),!1;const a={target:s};$.ajax({url:"/users/send_verify",type:"POST",dataType:"json",data:a,success:function(){$("#confirmResult").removeClass("warn"),$("#confirmResult").text("\uc778\uc99d\ubc88\ud638\uac00 \ubc1c\uc1a1\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")},error:function(e){null!=e.responseJSON&&null!=e.responseJSON.message?alert(e.responseJSON.message):alert("\ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.")}})}),$("#confirmRequestBtn").click(function(n){n.preventDefault();var s=$(this);const a=$("#login_user_id").val();if(!e())return $("#login_user_id").focus(),!1;const i={target:a};$.ajax({url:"/users/send_verify",type:"POST",dataType:"json",data:i,success:function(){s.hide(),$(".confirm-code-container").show()},error:function(e){null!=e.responseJSON&&null!=e.responseJSON.message?alert(e.responseJSON.message):alert("\ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.")}})}),$("#login_user_id").change(function(){e()}),$("#password_confirm").change(function(){n()}),$("#signupBtn").click(function(i){if(i.preventDefault(),!$("#terms").hasClass("active"))return void alert("\uc57d\uad00\uc5d0 \ub3d9\uc758\ud574 \uc8fc\uc138\uc694.");if("email"==$("#login_provider").val()){const s=e(),a=n();if(!s||!s)return a?s||$("#login_user_id").focus():$("#password").focus(),!1}else{if(!a())return $("#email").focus(),!1}const r=s(),o=!0;if(!r||!o)return r?o||$("#phone_number").focus():$("#name").focus(),!1;const l=$("#signupForm").serialize();$.ajax({url:"/users",type:"POST",dataType:"json",data:l,success:function(){location.href="/"},error:function(e){null!=e.responseJSON&&null!=e.responseJSON.message?alert(e.responseJSON.message):alert("\ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.")}})}),$("#phone_number").on("keypress input",function(e){if(!(e.keyCode>=37&&e.keyCode<=40)){var n=$(this).val();$(this).val(n.replace(/[^0-9]/gi,""))}})});